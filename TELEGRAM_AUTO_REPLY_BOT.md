# ü§ñ Telegram Auto-Reply Bot: –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

**–ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º —Ä–∏—Å–∫–æ–º –±–∞–Ω–∞ (<1%)**

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±—â–∞—è –∏–¥–µ—è –∏ –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏](#–æ–±—â–∞—è-–∏–¥–µ—è-–∏-–±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏)
2. [–°—Ç–æ–∏–º–æ—Å—Ç—å –∏ —ç–∫–æ–Ω–æ–º–∏–∫–∞](#—Å—Ç–æ–∏–º–æ—Å—Ç—å-–∏-—ç–∫–æ–Ω–æ–º–∏–∫–∞)
3. [–†–∏—Å–∫–∏ –±–∞–Ω–∞ –∏ –∑–∞—â–∏—Ç–∞](#—Ä–∏—Å–∫–∏-–±–∞–Ω–∞-–∏-–∑–∞—â–∏—Ç–∞)
4. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–∞–∫–∫–∞—É–Ω—Ç–æ–≤)
5. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
6. [–ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è](#–ø–æ–ª–Ω–∞—è-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
7. [–î–µ–ø–ª–æ–π –∏ –∑–∞–ø—É—Å–∫](#–¥–µ–ø–ª–æ–π-–∏-–∑–∞–ø—É—Å–∫)
8. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)

---

## üéØ –û–±—â–∞—è –∏–¥–µ—è –∏ –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏

### –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ Telegram –∫–∞–Ω–∞–ª—ã –æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è—Ö
2. –ù–∞—Ö–æ–¥–∏—Ç –≤–æ–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–æ –±–∏–ª–µ—Ç—ã, —Ü–µ–Ω—ã, –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ–ª–µ–∑–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —á–µ—Ä–µ–∑ AI
4. –ü—É–±–ª–∏–∫—É–µ—Ç –æ—Ç–≤–µ—Ç—ã —Å –Ω–µ–Ω–∞–≤—è–∑—á–∏–≤—ã–º —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º –≤–∞—à–µ–≥–æ –±–æ—Ç–∞

### –¶–µ–ª–µ–≤—ã–µ –∫–∞–Ω–∞–ª—ã

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ, < 10k –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤):**
- @budget_travel_ru
- @cheap_flights_rus
- @backpackers_russia
- @digital_nomads_ru
- @travel_hacks_community

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (—Å—Ä–µ–¥–Ω–∏–µ, 10k-50k):**
- @travelru
- @cheap_travel
- @poehali_travel

**‚ùå –ù–ï –¢–†–û–ì–ê–ï–ú (–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ/–∫—Ä—É–ø–Ω—ã–µ):**
- @aviasales (—Ä–∏—Å–∫ –±–∞–Ω–∞)
- @s7airlines (–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π)
- @tinkoff_travel (–±–∞–Ω–∫)

### –ë–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏ (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π)

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –û—Ç–≤–µ—Ç–æ–≤ –≤ –¥–µ–Ω—å | 20-25 |
| –û—Ç–≤–µ—Ç–æ–≤ –≤ –º–µ—Å—è—Ü | 600-750 |
| –†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ | 70% |
| –ö–æ–Ω–≤–µ—Ä—Å–∏—è –≤ –±–æ—Ç–∞ | 10-15% |
| **–ù–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π/–º–µ—Å—è—Ü** | **60-100** |
| –°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è (CAC) | **0.3‚ÇΩ** |

---

## üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å –∏ —ç–∫–æ–Ω–æ–º–∏–∫–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: –®–∞–±–ª–æ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã (–ë–ï–°–ü–õ–ê–¢–ù–û)

```
–°—Ç–æ–∏–º–æ—Å—Ç—å: 0‚ÇΩ/–º–µ—Å—è—Ü
–ö–∞—á–µ—Å—Ç–≤–æ: 6/10
–ö–æ–Ω–≤–µ—Ä—Å–∏—è: 8-10%
–ù–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 50-80/–º–µ—Å
```

**–ü–ª—é—Å—ã:**
- –ù—É–ª–µ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
- –ë—ã—Å—Ç—Ä–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –ù–∏–∑–∫–∏–π —Ä–∏—Å–∫

**–ú–∏–Ω—É—Å—ã:**
- –û—Ç–≤–µ—Ç—ã –≤—ã–≥–ª—è–¥—è—Ç —à–∞–±–ª–æ–Ω–Ω–æ
- –ù–∏–∂–µ –∫–æ–Ω–≤–µ—Ä—Å–∏—è
- –ú–æ–≥—É—Ç –¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ –±–æ—Ç–∞

### –í–∞—Ä–∏–∞–Ω—Ç 2: GPT-4o Mini (–†–ï–ö–û–ú–ï–ù–î–£–Æ)

**Pricing:**
- Input: $0.15 per 1M tokens
- Output: $0.60 per 1M tokens

**–°—Ç–æ–∏–º–æ—Å—Ç—å 1 –æ—Ç–≤–µ—Ç–∞:**
```
Input (550 tokens): $0.0000825
Output (125 tokens): $0.000075
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ò–¢–û–ì–û: $0.0001575 ‚âà 0.016‚ÇΩ
```

**–ú–µ—Å—è—á–Ω—ã–π –±—é–¥–∂–µ—Ç:**
```
20 –æ—Ç–≤–µ—Ç–æ–≤ √ó 30 –¥–Ω–µ–π = 600 –æ—Ç–≤–µ—Ç–æ–≤
600 √ó 0.016‚ÇΩ = 9.6‚ÇΩ/–º–µ—Å—è—Ü ‚âà 10‚ÇΩ
```

**–ü–ª—é—Å—ã:**
- –ü–æ—á—Ç–∏ –±–µ—Å–ø–ª–∞—Ç–Ω–æ
- –•–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ
- –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã

**–ú–∏–Ω—É—Å—ã:**
- –ß—É—Ç—å —Ö—É–∂–µ Claude
- –ò–Ω–æ–≥–¥–∞ —à–∞–±–ª–æ–Ω–Ω—ã–µ —Ñ—Ä–∞–∑—ã

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ì–∏–±—Ä–∏–¥–Ω—ã–π (–û–ü–¢–ò–ú–ê–õ–¨–ù–´–ô)

```swift
// 80% –≤–æ–ø—Ä–æ—Å–æ–≤ ‚Üí —à–∞–±–ª–æ–Ω—ã (0‚ÇΩ)
// 20% –≤–æ–ø—Ä–æ—Å–æ–≤ ‚Üí GPT-4o Mini (0.016‚ÇΩ)

20 –æ—Ç–≤–µ—Ç–æ–≤/–¥–µ–Ω—å:
16 √ó 0‚ÇΩ + 4 √ó 0.016‚ÇΩ = 0.064‚ÇΩ/–¥–µ–Ω—å
0.064‚ÇΩ √ó 30 = 1.92‚ÇΩ/–º–µ—Å—è—Ü ‚âà 2‚ÇΩ
```

**–°—Ç–æ–∏–º–æ—Å—Ç—å: ~2‚ÇΩ/–º–µ—Å—è—Ü**  
**–ö–∞—á–µ—Å—Ç–≤–æ: 8/10**  
**–ö–æ–Ω–≤–µ—Ä—Å–∏—è: 12-15%**  
**–ù–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 70-100/–º–µ—Å**

### üíé –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ä–µ–∫–ª–∞–º–æ–π

| –ú–µ—Ç–æ–¥ | –°—Ç–æ–∏–º–æ—Å—Ç—å/–º–µ—Å | –ù–æ–≤—ã—Ö —é–∑–µ—Ä–æ–≤ | CAC |
|-------|---------------|--------------|-----|
| **–ì–∏–±—Ä–∏–¥–Ω—ã–π –±–æ—Ç** | 2‚ÇΩ | 80 | **0.025‚ÇΩ** |
| **GPT-4o Mini** | 10‚ÇΩ | 80 | **0.125‚ÇΩ** |
| **Claude Sonnet** | 210‚ÇΩ | 100 | **2.1‚ÇΩ** |
| Telegram Ads | 50,000‚ÇΩ | 500 | 100‚ÇΩ |
| Google Ads | 100,000‚ÇΩ | 1000 | 100‚ÇΩ |

**–í—ã–≥–æ–¥–∞: –≤ 4000 —Ä–∞–∑ –¥–µ—à–µ–≤–ª–µ —Ä–µ–∫–ª–∞–º—ã!** üöÄ

---

## üõ° –†–∏—Å–∫–∏ –±–∞–Ω–∞ –∏ –∑–∞—â–∏—Ç–∞

### –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Ä–∏—Å–∫ <1%)

```swift
// Sources/App/Features/CommentBot/Config/SafetyConfig.swift

struct SafetyConfig {
    // –°–¢–†–û–ì–ò–ï –ª–∏–º–∏—Ç—ã
    static let maxRepliesPerHour = 2        // –í—Å–µ–≥–æ 2 –æ—Ç–≤–µ—Ç–∞ –≤ —á–∞—Å
    static let maxRepliesPerDay = 20        // 20 –æ—Ç–≤–µ—Ç–æ–≤ –≤ –¥–µ–Ω—å
    static let maxRepliesPerChannel = 3     // –ú–∞–∫—Å 3 –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –∫–∞–Ω–∞–ª/–¥–µ–Ω—å
    
    // –ë–û–õ–¨–®–ò–ï –∑–∞–¥–µ—Ä–∂–∫–∏
    static let minDelayBetweenReplies = 600.0      // 10 –º–∏–Ω—É—Ç –º–∏–Ω–∏–º—É–º
    static let randomDelayRange = 600.0...1200.0   // 10-20 –º–∏–Ω—É—Ç —Å–ª—É—á–∞–π–Ω–æ
    
    // –§–∏–ª—å—Ç—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    static let maxChannelSize = 10_000              // –¢–æ–ª—å–∫–æ –º–∞–ª—ã–µ –∫–∞–Ω–∞–ª—ã
    static let minQuestionRelevance = 0.7           // –¢–æ–ª—å–∫–æ –æ—á–µ–Ω—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ
    static let skipProbability = 0.4                // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º 40% –≤–æ–ø—Ä–æ—Å–æ–≤
    
    // Cooldown –ø–µ—Ä–∏–æ–¥—ã
    static let cooldownAfterComplaint = 172800.0    // 48 —á–∞—Å–æ–≤
    static let cooldownBetweenChannels = 3600.0     // 1 —á–∞—Å –º–µ–∂–¥—É –∫–∞–Ω–∞–ª–∞–º–∏
}
```

### –ü–æ—á–µ–º—É —Ä–∏—Å–∫ <1%?

#### ‚úÖ –°–æ–±–ª—é–¥–∞–µ–º –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –ª–∏–º–∏—Ç—ã Telegram:

**Telegram Bot API –ª–∏–º–∏—Ç—ã:**
- –ì—Ä—É–ø–ø–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è: 20 —Å–æ–æ–±—â–µ–Ω–∏–π/–º–∏–Ω—É—Ç—É –≤ –æ–¥–Ω—É –≥—Ä—É–ø–ø—É
- –û–±—â–∏–π –ª–∏–º–∏—Ç: 30 —Å–æ–æ–±—â–µ–Ω–∏–π/—Å–µ–∫—É–Ω–¥—É

**–ù–∞—à–∏ –ª–∏–º–∏—Ç—ã (–≤ 1800 —Ä–∞–∑ –º–µ–Ω—å—à–µ!):**
- 2 —Å–æ–æ–±—â–µ–Ω–∏—è/—á–∞—Å = 0.0005 —Å–æ–æ–±—â–µ–Ω–∏–π/—Å–µ–∫—É–Ω–¥—É
- 20 —Å–æ–æ–±—â–µ–Ω–∏–π/–¥–µ–Ω—å –≤ —Ä–∞–∑–Ω—ã–µ –∫–∞–Ω–∞–ª—ã

#### ‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞:

```swift
final class BanProtectionService {
    private let db: Database
    private let logger: Logger
    
    // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –æ—Ç–≤–µ—Ç–æ–º
    func canSafelyPost(to comment: Comment) async throws -> Bool {
        // A) –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ—Ç–≤–µ—Ç–∞
        guard let lastReply = try await getLastReply() else {
            return true // –ü–µ—Ä–≤—ã–π –æ—Ç–≤–µ—Ç –≤—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ
        }
        
        let timeSinceLast = Date().timeIntervalSince(lastReply.postedAt ?? Date())
        guard timeSinceLast >= SafetyConfig.minDelayBetweenReplies else {
            logger.warning("‚è∞ Too soon: \(Int(timeSinceLast))s < \(SafetyConfig.minDelayBetweenReplies)s")
            return false
        }
        
        // B) –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–Ω–µ–≤–Ω–æ–≥–æ –ª–∏–º–∏—Ç–∞
        let today = Date().addingTimeInterval(-86400)
        let repliesToday = try await Reply.query(on: db)
            .filter(\.$postedAt > today)
            .count()
        
        guard repliesToday < SafetyConfig.maxRepliesPerDay else {
            logger.warning("üìä Daily limit reached: \(repliesToday)/\(SafetyConfig.maxRepliesPerDay)")
            return false
        }
        
        // C) –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –Ω–∞ –∫–∞–Ω–∞–ª
        let post = try await comment.$post.get(on: db)
        let channel = try await post.$channel.get(on: db)
        
        let repliesInChannel = try await countRepliesInChannel(channel, since: today)
        guard repliesInChannel < SafetyConfig.maxRepliesPerChannel else {
            logger.warning("üì∫ Channel limit: \(repliesInChannel)/\(SafetyConfig.maxRepliesPerChannel)")
            return false
        }
        
        // D) –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –∫–∞–Ω–∞–ª–∞
        guard channel.subscribersCount < SafetyConfig.maxChannelSize else {
            logger.warning("üë• Channel too large: \(channel.subscribersCount)")
            return false
        }
        
        // E) –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∂–∞–ª–æ–±—ã
        if try await hasRecentComplaints() {
            logger.error("üö® Recent complaints detected! Entering cooldown mode")
            return false
        }
        
        return true
    }
    
    // 2. –î–µ—Ç–µ–∫—Ç –∂–∞–ª–æ–±
    func hasRecentComplaints() async throws -> Bool {
        let recentReplies = try await Reply.query(on: db)
            .sort(\.$postedAt, .descending)
            .limit(20)
            .all()
        
        // –ü–∞—Ä—Å–∏–º –æ—Ç–≤–µ—Ç—ã –Ω–∞ –Ω–∞—à–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å API –¥–æ—Å—Ç—É–ø)
        // –ò—â–µ–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: "—Å–ø–∞–º", "–±–æ—Ç", "—Ä–µ–∫–ª–∞–º–∞", "–ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç–µ"
        
        // –ü–æ–∫–∞ —É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è: –ø—Ä–æ–≤–µ—Ä—è–µ–º engagement rate
        let withEngagement = recentReplies.filter { reply in
            // –ï—Å–ª–∏ –µ—Å—Ç—å –ª–∞–π–∫–∏/—Ä–µ–∞–∫—Ü–∏–∏ –Ω–∞ –Ω–∞—à –æ—Ç–≤–µ—Ç = –≤—Å—ë –û–ö
            return reply.telegramReplyId != nil
        }
        
        let engagementRate = Double(withEngagement.count) / Double(recentReplies.count)
        
        // –ï—Å–ª–∏ engagement < 10% - –≤–æ–∑–º–æ–∂–Ω–æ, –Ω–∞—Å —Å—á–∏—Ç–∞—é—Ç —Å–ø–∞–º–æ–º
        return engagementRate < 0.1
    }
    
    // 3. Emergency stop
    func emergencyStop(reason: String) async throws {
        logger.error("üö® EMERGENCY STOP: \(reason)")
        
        // –°–æ–∑–¥–∞—ë–º –∑–∞–ø–∏—Å—å –æ –ø—Ä–æ–±–ª–µ–º–µ
        let incident = Incident()
        incident.reason = reason
        incident.timestamp = Date()
        incident.cooldownUntil = Date().addingTimeInterval(SafetyConfig.cooldownAfterComplaint)
        try await incident.save(on: db)
        
        // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –∑–∞–¥–∞—á–∏
        // (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ —Ñ–ª–∞–≥ –≤ –ë–î, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è—é—Ç Jobs)
    }
}
```

---

## üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ Telegram –±–æ—Ç–∞ –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–í–∞–∂–Ω–æ:** –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞ (@gdeTravel_bot)! –°–æ–∑–¥–∞–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ.

#### 1.1 –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather

```
1. –û—Ç–∫—Ä—ã–≤–∞–µ–º Telegram, –∏—â–µ–º @BotFather
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º: /newbot
3. –ù–∞–∑–≤–∞–Ω–∏–µ: "GdeTravel Helper" (–ª—é–±–æ–µ)
4. Username: gdetravel_helper_bot (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º)
5. –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω: 1234567890:ABCdefGHIjklMNOpqrsTUVwxyz

‚ö†Ô∏è –°–û–•–†–ê–ù–ò–¢–ï –¢–û–ö–ï–ù! –û–Ω –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –≤ .env
```

#### 1.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ—Ç–∞

```
/setdescription - "–ü–æ–º–æ—â–Ω–∏–∫ –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º –æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è—Ö"
/setabouttext - "–û—Ç–≤–µ—á–∞—é –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ –¥–µ—à—ë–≤—ã—Ö –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è—Ö"
/setuserpic - –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä–∫—É (–ª–æ–≥–æ—Ç–∏–ø –≤–∞—à–µ–≥–æ –±—Ä–µ–Ω–¥–∞)
```

#### 1.3 –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –±–æ—Ç–æ–≤ (–Ω–∞ —Å–ª—É—á–∞–π –±–∞–Ω–∞)

```
–°–æ–∑–¥–∞–π—Ç–µ –µ—â—ë 2-3 –±–æ—Ç–∞ –∑–∞—Ä–∞–Ω–µ–µ:
- gdetravel_helper2_bot
- gdetravel_assistant_bot
- gdetravel_tips_bot

–•—Ä–∞–Ω–∏—Ç–µ –∏—Ö —Ç–æ–∫–µ–Ω—ã –≤ .env:
TELEGRAM_BOT_TOKEN=–æ—Å–Ω–æ–≤–Ω–æ–π
TELEGRAM_BOT_TOKEN_BACKUP1=—Ä–µ–∑–µ—Ä–≤–Ω—ã–π1
TELEGRAM_BOT_TOKEN_BACKUP2=—Ä–µ–∑–µ—Ä–≤–Ω—ã–π2
```

### –®–∞–≥ 2: –ü–æ–ª—É—á–µ–Ω–∏–µ Claude API –∫–ª—é—á–∞

#### 2.1 –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Anthropic

```
1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ https://console.anthropic.com/
2. Sign Up ‚Üí —á–µ—Ä–µ–∑ Google –∞–∫–∫–∞—É–Ω—Ç
3. Verify email
4. Settings ‚Üí API Keys
5. Create Key ‚Üí –ù–∞–∑–≤–∞–Ω–∏–µ: "telegram-reply-bot"
6. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á: sk-ant-api03-xxxxxxxxxxxxx

‚ö†Ô∏è –ö–ª—é—á –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –û–î–ò–ù –†–ê–ó! –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤ .env
```

#### 2.2 –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞

```
1. Settings ‚Üí Billing
2. Add payment method (–∫–∞—Ä—Ç–∞)
3. –ü–æ–ø–æ–ª–Ω–∏—Ç—å: $5 (—Ö–≤–∞—Ç–∏—Ç –Ω–∞ 5-6 –º–µ—Å—è—Ü–µ–≤ —Ä–∞–±–æ—Ç—ã)

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ü–æ—Å—Ç–∞–≤–∏—Ç—å –ª–∏–º–∏—Ç $10/–º–µ—Å—è—Ü –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```

#### 2.3 –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: GPT-4o Mini (OpenAI)

**–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –µ—â—ë –¥–µ—à–µ–≤–ª–µ:**

```
1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ https://platform.openai.com/
2. Sign Up
3. API Keys ‚Üí Create new secret key
4. –ù–∞–∑–≤–∞–Ω–∏–µ: "telegram-bot"
5. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å: sk-proj-xxxxxxxxxxxxx

–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ:
- Settings ‚Üí Billing ‚Üí Add $5
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å usage limit: $5/month
```

### –®–∞–≥ 3: PostgreSQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

#### 3.1 Railway (—Ä–µ–∫–æ–º–µ–Ω–¥—É—é)

```
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ https://railway.app/
2. New Project ‚Üí Provision PostgreSQL
3. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å DATABASE_URL –∏–∑ Variables
4. –§–æ—Ä–º–∞—Ç: postgres://user:pass@host:5432/dbname

–°—Ç–æ–∏–º–æ—Å—Ç—å: $5/–º–µ—Å—è—Ü (trial: $5 –±–µ—Å–ø–ª–∞—Ç–Ω–æ –ø–µ—Ä–≤—ã–π –º–µ—Å—è—Ü)
```

#### 3.2 –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: Supabase (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)

```
1. https://supabase.com/ ‚Üí Start your project
2. Create organization ‚Üí Create project
3. Database password (—Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ!)
4. Settings ‚Üí Database ‚Üí Connection string
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ URI mode

–°—Ç–æ–∏–º–æ—Å—Ç—å: 0‚ÇΩ (Free tier: 500MB DB)
```

### –®–∞–≥ 4: –°–±–æ—Ä–∫–∞ .env —Ñ–∞–π–ª–∞

```bash
# .env (–≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞)

# ===== DATABASE =====
DATABASE_URL=postgres://user:pass@host.railway.app:5432/railway

# ===== TELEGRAM BOTS =====
# –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz

# –†–µ–∑–µ—Ä–≤–Ω—ã–µ (–Ω–∞ —Å–ª—É—á–∞–π –±–∞–Ω–∞)
TELEGRAM_BOT_TOKEN_BACKUP1=9876543210:ZYXwvuTSRqponMLKjihgfedcba
TELEGRAM_BOT_TOKEN_BACKUP2=1122334455:AaBbCcDdEeFfGgHhIiJjKkLlMm

# –í–∞—à –æ—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç (–¥–ª—è —É–ø–æ–º–∏–Ω–∞–Ω–∏—è)
BOT_USERNAME=gdeTravel_bot

# ===== AI API =====
# –í–∞—Ä–∏–∞–Ω—Ç A: Claude (–¥–æ—Ä–æ–∂–µ, –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–µ–µ)
CLAUDE_API_KEY=sk-ant-api03-xxxxxxxxxxxxx

# –í–∞—Ä–∏–∞–Ω—Ç B: OpenAI GPT-4o Mini (–¥–µ—à–µ–≤–ª–µ)
OPENAI_API_KEY=sk-proj-xxxxxxxxxxxxx

# –ö–∞–∫–æ–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å? (claude –∏–ª–∏ openai)
AI_PROVIDER=openai

# ===== SAFETY CONFIG =====
# –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
MAX_REPLIES_PER_DAY=20
MAX_REPLIES_PER_HOUR=2
MIN_DELAY_SECONDS=600
MAX_CHANNEL_SIZE=10000

# ===== SERVER =====
PORT=8080
LOG_LEVEL=info
ENVIRONMENT=production
```

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –û–±—â–∞—è —Å—Ö–µ–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  TELEGRAM AUTO-REPLY BOT                     ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê            ‚îÇ
‚îÇ  ‚îÇ  Channel   ‚îÇ‚Üí ‚îÇ  Comment   ‚îÇ‚Üí ‚îÇ   Reply    ‚îÇ            ‚îÇ
‚îÇ  ‚îÇ  Monitor   ‚îÇ  ‚îÇ  Analyzer  ‚îÇ  ‚îÇ  Generator ‚îÇ            ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îÇ
‚îÇ         ‚îÇ               ‚îÇ                ‚îÇ                  ‚îÇ
‚îÇ         v               v                v                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ
‚îÇ  ‚îÇ         PostgreSQL Database                   ‚îÇ          ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ          ‚îÇ
‚îÇ  ‚îÇ  ‚îÇChannel ‚îÇ ‚îÇ Post ‚îÇ ‚îÇ Comment  ‚îÇ ‚îÇ Reply  ‚îÇ‚îÇ          ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ          ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ
‚îÇ                          ‚îÇ                                  ‚îÇ
‚îÇ                          v                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ
‚îÇ  ‚îÇ         Background Jobs (Queues)              ‚îÇ          ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ ChannelScanJob (–∫–∞–∂–¥—ã–µ 15 –º–∏–Ω)            ‚îÇ          ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ CommentAnalysisJob (–∫–∞–∂–¥—ã–µ 10 –º–∏–Ω)        ‚îÇ          ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ ReplyPostingJob (–∫–∞–∂–¥—ã–µ 20 –º–∏–Ω)           ‚îÇ          ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ SafetyCheckJob (–∫–∞–∂–¥—ã–π —á–∞—Å)               ‚îÇ          ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
                             v
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ   External Services      ‚îÇ
              ‚îÇ  ‚Ä¢ Telegram Bot API      ‚îÇ
              ‚îÇ  ‚Ä¢ OpenAI GPT-4o Mini    ‚îÇ
              ‚îÇ  ‚Ä¢ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) Claude  ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
1. ChannelScanJob (–∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç)
   ‚îú‚îÄ –°–∫–∞–Ω–∏—Ä—É–µ—Ç —Ü–µ–ª–µ–≤—ã–µ –∫–∞–Ω–∞–ª—ã
   ‚îú‚îÄ –ù–∞—Ö–æ–¥–∏—Ç –Ω–æ–≤—ã–µ –ø–æ—Å—Ç—ã
   ‚îî‚îÄ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î
          ‚Üì
2. CommentAnalysisJob (–∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç)
   ‚îú‚îÄ –ü–∞—Ä—Å–∏—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø–æ—Å—Ç–∞–º
   ‚îú‚îÄ –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤–æ–ø—Ä–æ—Å—ã (QuestionDetector)
   ‚îú‚îÄ –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å (0.0-1.0)
   ‚îî‚îÄ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç (AI –∏–ª–∏ —à–∞–±–ª–æ–Ω)
          ‚Üì
3. ReplyPostingJob (–∫–∞–∂–¥—ã–µ 20 –º–∏–Ω—É—Ç)
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–∏–º–∏—Ç—ã (AntiSpam)
   ‚îú‚îÄ –î–æ–±–∞–≤–ª—è–µ—Ç —Å–ª—É—á–∞–π–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É (10-20 –º–∏–Ω)
   ‚îú‚îÄ –ü—É–±–ª–∏–∫—É–µ—Ç –æ—Ç–≤–µ—Ç
   ‚îî‚îÄ –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
          ‚Üì
4. SafetyCheckJob (–∫–∞–∂–¥—ã–π —á–∞—Å)
   ‚îú‚îÄ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç engagement rate
   ‚îú‚îÄ –î–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç –∂–∞–ª–æ–±—ã
   ‚îú‚îÄ –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç –ª–∏–º–∏—Ç—ã
   ‚îî‚îÄ Emergency stop –ø—Ä–∏ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
telegram-auto-reply-bot/
‚îÇ
‚îú‚îÄ‚îÄ Package.swift                    # Swift Package Manager
‚îú‚îÄ‚îÄ Dockerfile                       # Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
‚îú‚îÄ‚îÄ docker-compose.yml              # –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
‚îú‚îÄ‚îÄ .env.example                    # –®–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ README.md
‚îÇ
‚îú‚îÄ‚îÄ Sources/
‚îÇ   ‚îî‚îÄ‚îÄ App/
‚îÇ       ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ Application/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ main.swift                      # Entry point
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ configure.swift                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ routes.swift                    # API endpoints
‚îÇ       ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ Models/                             # üìä –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ Channel.swift                   # Telegram –∫–∞–Ω–∞–ª
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ Post.swift                      # –ü–æ—Å—Ç –≤ –∫–∞–Ω–∞–ª–µ
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ Comment.swift                   # –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –ø–æ—Å—Ç—É
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ Reply.swift                     # –ù–∞—à –æ—Ç–≤–µ—Ç
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ Incident.swift                  # –ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã (–±–∞–Ω—ã, –∂–∞–ª–æ–±—ã)
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ ChannelCategory.swift           # Enum –∫–∞—Ç–µ–≥–æ—Ä–∏–π
‚îÇ       ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ Database/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ Migrations/
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ CreateChannels.swift
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ CreatePosts.swift
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ CreateComments.swift
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ CreateReplies.swift
‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ CreateIncidents.swift
‚îÇ       ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ Services/                           # üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
‚îÇ       ‚îÇ   ‚îÇ
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ Core/                          # –ë–∞–∑–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TelegramClient.swift       # Telegram API –∫–ª–∏–µ–Ω—Ç
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AIClient.swift             # OpenAI/Claude –∫–ª–∏–µ–Ω—Ç
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ DatabaseService.swift      # –•–µ–ª–ø–µ—Ä—ã –¥–ª—è –ë–î
‚îÇ       ‚îÇ   ‚îÇ
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ ChannelMonitor/                # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞–Ω–∞–ª–æ–≤
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChannelDiscoveryService.swift    # –ü–æ–∏—Å–∫ –Ω–æ–≤—ã—Ö –∫–∞–Ω–∞–ª–æ–≤
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ChannelMonitorService.swift      # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PostParserService.swift          # –ü–∞—Ä—Å–∏–Ω–≥ –ø–æ—Å—Ç–æ–≤
‚îÇ       ‚îÇ   ‚îÇ
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ CommentAnalyzer/               # –ê–Ω–∞–ª–∏–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CommentParserService.swift       # –ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ QuestionDetectorService.swift    # –î–µ—Ç–µ–∫—Ç –≤–æ–ø—Ä–æ—Å–æ–≤
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ KeywordMatcher.swift             # –ü–æ–∏—Å–∫ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RelevanceCalculator.swift        # –†–∞—Å—á—ë—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
‚îÇ       ‚îÇ   ‚îÇ
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ ReplyGenerator/                # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TemplateReplyService.swift       # –®–∞–±–ª–æ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AIReplyService.swift             # AI –æ—Ç–≤–µ—Ç—ã
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ HybridReplyService.swift         # –ì–∏–±—Ä–∏–¥
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PromptBuilder.swift              # –ü—Ä–æ–º–ø—Ç—ã –¥–ª—è AI
‚îÇ       ‚îÇ   ‚îÇ
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ ReplyPoster/                   # –ü—É–±–ª–∏–∫–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CommentPosterService.swift       # –ü–æ—Å—Ç–∏–Ω–≥ –≤ Telegram
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AntiSpamService.swift            # –ê–Ω—Ç–∏-—Å–ø–∞–º –ø—Ä–æ–≤–µ—Ä–∫–∏
‚îÇ       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RateLimiter.swift                # Rate limiting
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ BanProtectionService.swift       # –ó–∞—â–∏—Ç–∞ –æ—Ç –±–∞–Ω–∞
‚îÇ       ‚îÇ   ‚îÇ
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ Safety/                        # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ SafetyConfig.swift               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ª–∏–º–∏—Ç–æ–≤
‚îÇ       ‚îÇ       ‚îú‚îÄ‚îÄ ComplaintDetector.swift          # –î–µ—Ç–µ–∫—Ç –∂–∞–ª–æ–±
‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ EmergencyStopService.swift       # –ê–≤–∞—Ä–∏–π–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
‚îÇ       ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ Jobs/                                    # üîÑ –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ ChannelScanJob.swift                 # –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ CommentAnalysisJob.swift             # –ê–Ω–∞–ª–∏–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ ReplyPostingJob.swift                # –ü—É–±–ª–∏–∫–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ SafetyCheckJob.swift                 # –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
‚îÇ       ‚îÇ
‚îÇ       ‚îî‚îÄ‚îÄ Utilities/
‚îÇ           ‚îú‚îÄ‚îÄ Logger+Bot.swift
‚îÇ           ‚îî‚îÄ‚îÄ Extensions.swift
‚îÇ
‚îî‚îÄ‚îÄ Tests/
    ‚îî‚îÄ‚îÄ AppTests/
        ‚îú‚îÄ‚îÄ QuestionDetectorTests.swift
        ‚îú‚îÄ‚îÄ ReplyGeneratorTests.swift
        ‚îú‚îÄ‚îÄ AntiSpamTests.swift
        ‚îî‚îÄ‚îÄ SafetyTests.swift
```

---

## üíª –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. Package.swift

```swift
// swift-tools-version:5.9
import PackageDescription

let package = Package(
    name: "telegram-auto-reply-bot",
    platforms: [
        .macOS(.v13)
    ],
    dependencies: [
        .package(url: "https://github.com/vapor/vapor.git", from: "4.99.0"),
        .package(url: "https://github.com/vapor/fluent.git", from: "4.9.0"),
        .package(url: "https://github.com/vapor/fluent-postgres-driver.git", from: "2.8.0"),
        .package(url: "https://github.com/vapor/queues.git", from: "1.13.0"),
    ],
    targets: [
        .executableTarget(
            name: "App",
            dependencies: [
                .product(name: "Vapor", package: "vapor"),
                .product(name: "Fluent", package: "fluent"),
                .product(name: "FluentPostgresDriver", package: "fluent-postgres-driver"),
                .product(name: "Queues", package: "queues"),
            ],
            path: "Sources/App"
        )
    ]
)
```

### 2. Models/Channel.swift

```swift
import Fluent
import Vapor

final class Channel: Model, Content {
    static let schema = "channels"
    
    @ID(key: .id)
    var id: UUID?
    
    @Field(key: "username")
    var username: String // @budget_travel_ru
    
    @Field(key: "title")
    var title: String
    
    @Enum(key: "category")
    var category: ChannelCategory
    
    @Field(key: "subscribers_count")
    var subscribersCount: Int
    
    @Field(key: "is_active")
    var isActive: Bool
    
    @Field(key: "is_whitelisted")
    var isWhitelisted: Bool // –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–ª—è –ø–æ—Å—Ç–∏–Ω–≥–∞
    
    @Field(key: "last_scanned_at")
    var lastScannedAt: Date?
    
    @Field(key: "replies_count_today")
    var repliesCountToday: Int
    
    @Timestamp(key: "created_at", on: .create)
    var createdAt: Date?
    
    @Timestamp(key: "updated_at", on: .update)
    var updatedAt: Date?
    
    @Children(for: \.$channel)
    var posts: [Post]
    
    init() {}
    
    init(
        id: UUID? = nil,
        username: String,
        title: String,
        category: ChannelCategory,
        subscribersCount: Int,
        isWhitelisted: Bool = false
    ) {
        self.id = id
        self.username = username
        self.title = title
        self.category = category
        self.subscribersCount = subscribersCount
        self.isActive = true
        self.isWhitelisted = isWhitelisted
        self.repliesCountToday = 0
    }
}

enum ChannelCategory: String, Codable {
    case travel = "travel"
    case budget = "budget"
    case flights = "flights"
    case destinations = "destinations"
    case nomads = "nomads"
}
```

### 3. Models/Comment.swift

```swift
import Fluent
import Vapor

final class Comment: Model, Content {
    static let schema = "comments"
    
    @ID(key: .id)
    var id: UUID?
    
    @Parent(key: "post_id")
    var post: Post
    
    @Field(key: "telegram_message_id")
    var telegramMessageId: Int
    
    @Field(key: "author_id")
    var authorId: Int
    
    @Field(key: "author_username")
    var authorUsername: String?
    
    @Field(key: "text")
    var text: String
    
    @Field(key: "is_question")
    var isQuestion: Bool
    
    @Field(key: "relevance_score")
    var relevanceScore: Double // 0.0 - 1.0
    
    @Field(key: "keywords_matched")
    var keywordsMatched: [String]
    
    @Field(key: "category")
    var category: String? // ticket_search, pricing, etc
    
    @Field(key: "replied")
    var replied: Bool
    
    @Field(key: "sentiment")
    var sentiment: String? // positive, neutral, negative
    
    @Timestamp(key: "created_at", on: .create)
    var createdAt: Date?
    
    @OptionalChild(for: \.$comment)
    var reply: Reply?
    
    init() {}
}
```

### 4. Services/Core/TelegramClient.swift

```swift
import Vapor

final class TelegramClient {
    private let client: Client
    private let botToken: String
    private let logger: Logger
    private let baseURL = "https://api.telegram.org"
    
    init(client: Client, botToken: String, logger: Logger) {
        self.client = client
        self.botToken = botToken
        self.logger = logger
    }
    
    // –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–Ω–∞–ª–µ
    func getChat(username: String) async throws -> TelegramChat {
        let url = URI(string: "\(baseURL)/bot\(botToken)/getChat")
        
        var request = ClientRequest(method: .POST, url: url)
        request.headers.add(name: .contentType, value: "application/json")
        
        let body: [String: Any] = ["chat_id": "@\(username)"]
        request.body = .init(data: try JSONSerialization.data(withJSONObject: body))
        
        let response = try await client.send(request)
        
        struct Response: Codable {
            let ok: Bool
            let result: TelegramChat
        }
        
        let apiResponse = try response.content.decode(Response.self)
        return apiResponse.result
    }
    
    // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–æ—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ)
    func sendReply(
        chatUsername: String,
        replyToMessageId: Int,
        text: String
    ) async throws -> Int {
        let url = URI(string: "\(baseURL)/bot\(botToken)/sendMessage")
        
        var request = ClientRequest(method: .POST, url: url)
        request.headers.add(name: .contentType, value: "application/json")
        
        let body: [String: Any] = [
            "chat_id": "@\(chatUsername)",
            "text": text,
            "reply_to_message_id": replyToMessageId,
            "parse_mode": "HTML"
        ]
        request.body = .init(data: try JSONSerialization.data(withJSONObject: body))
        
        logger.info("üì§ Sending reply to @\(chatUsername), message \(replyToMessageId)")
        
        let response = try await client.send(request)
        
        guard response.status == .ok else {
            let errorBody = response.body.map { String(buffer: $0) } ?? "No body"
            logger.error("‚ùå Telegram API error: \(response.status) - \(errorBody)")
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏
            if errorBody.contains("Flood control") {
                logger.error("üö® FLOOD CONTROL! Too many requests")
                throw BotError.floodControl
            }
            
            if errorBody.contains("bot was blocked") {
                logger.error("üö® BOT BLOCKED!")
                throw BotError.botBlocked
            }
            
            throw Abort(.internalServerError, reason: "Telegram API error")
        }
        
        struct Response: Codable {
            struct Result: Codable {
                let messageId: Int
                enum CodingKeys: String, CodingKey {
                    case messageId = "message_id"
                }
            }
            let ok: Bool
            let result: Result
        }
        
        let apiResponse = try response.content.decode(Response.self)
        logger.info("‚úÖ Reply sent successfully, message_id: \(apiResponse.result.messageId)")
        
        return apiResponse.result.messageId
    }
}

struct TelegramChat: Codable {
    let id: Int
    let type: String
    let title: String?
    let username: String?
    let membersCount: Int?
    
    enum CodingKeys: String, CodingKey {
        case id, type, title, username
        case membersCount = "members_count"
    }
}

enum BotError: Error {
    case floodControl
    case botBlocked
    case channelNotFound
}
```

### 5. Services/CommentAnalyzer/QuestionDetectorService.swift

```swift
import Vapor

struct QuestionPattern {
    let keywords: [String]
    let category: String
    let weight: Double
}

final class QuestionDetectorService {
    private let logger: Logger
    
    // –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–µ - —Ç–æ–ª—å–∫–æ –æ—á–µ–≤–∏–¥–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã)
    private let patterns: [QuestionPattern] = [
        QuestionPattern(
            keywords: ["–≥–¥–µ –Ω–∞–π—Ç–∏ –±–∏–ª–µ—Ç", "–≥–¥–µ –∫—É–ø–∏—Ç—å –±–∏–ª–µ—Ç", "–≥–¥–µ –∏—Å–∫–∞—Ç—å –¥–µ—à–µ–≤—ã–µ"],
            category: "ticket_search",
            weight: 1.0
        ),
        QuestionPattern(
            keywords: ["—Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç", "–∫–∞–∫–∞—è —Ü–µ–Ω–∞", "—Ü–µ–Ω–∞ –±–∏–ª–µ—Ç–∞", "—Å—Ç–æ–∏–º–æ—Å—Ç—å"],
            category: "pricing",
            weight: 0.9
        ),
        QuestionPattern(
            keywords: ["–∫–∞–∫–æ–π —Å–µ—Ä–≤–∏—Å", "–∫–∞–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ", "–∫–∞–∫–æ–π —Å–∞–π—Ç –ª—É—á—à–µ"],
            category: "service_recommendation",
            weight: 1.0
        ),
        QuestionPattern(
            keywords: ["–∫—É–¥–∞ –ø–æ–ª–µ—Ç–µ—Ç—å", "–∫—É–¥–∞ –ø–æ–µ—Ö–∞—Ç—å", "—á—Ç–æ –ø–æ—Å–æ–≤–µ—Ç—É–µ—Ç–µ", "–∫–∞–∫—É—é —Å—Ç—Ä–∞–Ω—É"],
            category: "destination",
            weight: 0.7
        ),
        QuestionPattern(
            keywords: ["–∫–∞–∫ —ç–∫–æ–Ω–æ–º–∏—Ç—å", "–∫–∞–∫ —Å—ç–∫–æ–Ω–æ–º–∏—Ç—å", "–∫–∞–∫ –¥–µ—à–µ–≤–ª–µ", "–ª–∞–π—Ñ—Ö–∞–∫"],
            category: "savings",
            weight: 0.8
        )
    ]
    
    init(logger: Logger) {
        self.logger = logger
    }
    
    // –Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–æ–º?
    func isQuestion(_ text: String) -> Bool {
        let normalized = text.lowercased().trimmingCharacters(in: .whitespacesAndNewlines)
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –ï—Å—Ç—å –≤–æ–ø—Ä–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –∑–Ω–∞–∫?
        if normalized.contains("?") {
            return true
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –≤–æ–ø—Ä–æ—Å–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Å–ª–æ–≤–∞?
        let questionStarters = [
            "–≥–¥–µ", "–∫–∞–∫", "–∫–æ–≥–¥–∞", "–ø–æ—á–µ–º—É", "–∑–∞—á–µ–º",
            "–∫–∞–∫–æ–π", "–∫–∞–∫–∞—è", "–∫–∞–∫–æ–µ", "–∫–∞–∫–∏–µ",
            "–∫—Ç–æ", "—á—Ç–æ", "—Å–∫–æ–ª—å–∫–æ", "—á–µ–º"
        ]
        
        for starter in questionStarters {
            if normalized.hasPrefix(starter + " ") {
                return true
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –°–æ–¥–µ—Ä–∂–∏—Ç –≤–æ–ø—Ä–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏?
        let questionPhrases = [
            "–ø–æ–¥—Å–∫–∞–∂–∏—Ç–µ", "–ø–æ—Å–æ–≤–µ—Ç—É–π—Ç–µ", "–ø–æ–º–æ–≥–∏—Ç–µ",
            "–∫—Ç–æ –∑–Ω–∞–µ—Ç", "–º–æ–∂–µ—Ç –∫—Ç–æ", "–∫—Ç–æ-–Ω–∏–±—É–¥—å –∑–Ω–∞–µ—Ç"
        ]
        
        for phrase in questionPhrases {
            if normalized.contains(phrase) {
                return true
            }
        }
        
        return false
    }
    
    // –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –≤–æ–ø—Ä–æ—Å–∞
    func detectCategory(_ text: String) -> String? {
        let normalized = text.lowercased()
        var bestMatch: (category: String, score: Double) = ("unknown", 0.0)
        
        for pattern in patterns {
            var score = 0.0
            
            for keyword in pattern.keywords {
                if normalized.contains(keyword) {
                    score += pattern.weight
                }
            }
            
            if score > bestMatch.score {
                bestMatch = (pattern.category, score)
            }
        }
        
        return bestMatch.score > 0 ? bestMatch.category : nil
    }
    
    // –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å (0.0 - 1.0)
    func calculateRelevance(_ text: String) -> Double {
        let normalized = text.lowercased()
        var score = 0.0
        
        // –ë–∞–∑–æ–≤—ã–π –±–∞–ª–ª –∑–∞ –≤–æ–ø—Ä–æ—Å
        if isQuestion(text) {
            score += 0.3
        }
        
        // –ë–∞–ª–ª—ã –∑–∞ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
        for pattern in patterns {
            for keyword in pattern.keywords {
                if normalized.contains(keyword) {
                    score += pattern.weight * 0.15
                }
            }
        }
        
        // –ë–æ–Ω—É—Å –∑–∞ –¥–ª–∏–Ω—É (—Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã)
        let wordCount = normalized.split(separator: " ").count
        if wordCount >= 5 && wordCount <= 50 {
            score += 0.2
        }
        
        // –®—Ç—Ä–∞—Ñ –∑–∞ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–µ
        if wordCount < 3 {
            score -= 0.3
        }
        
        return min(max(score, 0.0), 1.0)
    }
    
    // –ù–∞–π—Ç–∏ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
    func matchKeywords(_ text: String) -> [String] {
        let normalized = text.lowercased()
        var matched: [String] = []
        
        for pattern in patterns {
            for keyword in pattern.keywords {
                if normalized.contains(keyword) {
                    matched.append(keyword)
                }
            }
        }
        
        return Array(Set(matched))
    }
}
```

### 6. Services/ReplyGenerator/HybridReplyService.swift

```swift
import Vapor

final class HybridReplyService {
    private let templateService: TemplateReplyService
    private let aiService: AIReplyService
    private let logger: Logger
    
    // –ü–æ—Ä–æ–≥ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è AI (—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å)
    private let aiThreshold = 0.75
    
    init(
        templateService: TemplateReplyService,
        aiService: AIReplyService,
        logger: Logger
    ) {
        self.templateService = templateService
        self.aiService = aiService
        self.logger = logger
    }
    
    func generateReply(
        question: String,
        category: String?,
        relevance: Double,
        context: ReplyContext
    ) async throws -> String {
        // –ü—Ä–æ—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã (—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å < 0.75) ‚Üí —à–∞–±–ª–æ–Ω—ã
        if relevance < aiThreshold {
            logger.info("üìù Using template reply (relevance: \(String(format: "%.2f", relevance)))")
            
            let template = templateService.generateReply(
                category: category ?? "general",
                context: context
            )
            
            return addBotMention(to: template, probability: 0.8)
        }
        
        // –°–ª–æ–∂–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã ‚Üí AI
        logger.info("ü§ñ Using AI reply (relevance: \(String(format: "%.2f", relevance)))")
        
        let aiReply = try await aiService.generateReply(
            question: question,
            category: category,
            context: context
        )
        
        return addBotMention(to: aiReply, probability: 0.9)
    }
    
    // –î–æ–±–∞–≤–∏—Ç—å —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –±–æ—Ç–∞ (–Ω–µ –≤—Å–µ–≥–¥–∞!)
    private func addBotMention(to text: String, probability: Double) -> String {
        // –°–ª—É—á–∞–π–Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ
        if Double.random(in: 0...1) > probability {
            logger.info("üé≤ Skipping bot mention (natural variation)")
            return text
        }
        
        // –í–∞—Ä–∏–∞–Ω—Ç—ã —É–ø–æ–º–∏–Ω–∞–Ω–∏—è (—Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏)
        let mentions = [
            "\n\nüí° –ö—Å—Ç–∞—Ç–∏, @\(context.botUsername) –ø–æ–º–æ–≥–∞–µ—Ç —Å —Ç–∞–∫–∏–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏",
            "\n\nü§ñ –ï—â—ë –µ—Å—Ç—å @\(context.botUsername), —É–¥–æ–±–Ω–∞—è —à—Ç—É–∫–∞",
            "\n\n‚úàÔ∏è –ü–æ–ø—Ä–æ–±—É–π—Ç–µ @\(context.botUsername) –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ü–µ–Ω",
            "\n\n–°–∞–º –ø–æ–ª—å–∑—É—é—Å—å @\(context.botUsername), —Ä–µ–∫–æ–º–µ–Ω–¥—É—é",
            "\n\nüì± @\(context.botUsername) –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ—Ö–æ–∂–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã"
        ]
        
        return text + mentions.randomElement()!
    }
}

struct ReplyContext {
    let channelName: String
    let postTopic: String?
    let botUsername: String
}
```

### 7. Services/ReplyGenerator/TemplateReplyService.swift

```swift
import Vapor

final class TemplateReplyService {
    private let logger: Logger
    
    // –®–∞–±–ª–æ–Ω—ã –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
    private let templates: [String: [String]] = [
        "ticket_search": [
            "–°–æ–≤–µ—Ç—É—é –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä–æ–≤: Aviasales, Skyscanner, –Ø–Ω–¥–µ–∫—Å –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è. –õ—É—á—à–∏–µ —Ü–µ–Ω—ã –æ–±—ã—á–Ω–æ –≤ —Å—Ä–µ–¥—É-—á–µ—Ç–≤–µ—Ä–≥ üòä",
            "–Ø –æ–±—ã—á–Ω–æ –º–æ–Ω–∏—Ç–æ—Ä—é Aviasales + Google Flights. –ï—â—ë –º–æ–∂–Ω–æ –ª–æ–≤–∏—Ç—å –æ—à–∏–±–æ—á–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã ‚Äî –∏–Ω–æ–≥–¥–∞ —Å–∫–∏–¥–∫–∏ –¥–æ 50%.",
            "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–Ω—ã–µ –¥–∞—Ç—ã (¬±3 –¥–Ω—è), —á–∞—Å—Ç–æ —Ä–∞–∑–Ω–∏—Ü–∞ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç—ã—Å—è—á. –ê–≥—Ä–µ–≥–∞—Ç–æ—Ä—ã –ø–æ–º–æ–≥–∞—é—Ç —Å—Ä–∞–≤–Ω–∏—Ç—å —Å—Ä–∞–∑—É –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã."
        ],
        
        "pricing": [
            "–¶–µ–Ω—ã —Å–µ–π—á–∞—Å –≤ —Å—Ä–µ–¥–Ω–µ–º 15-20 —Ç—ã—Å—è—á. –ï—Å–ª–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω–æ, –º–æ–∂–Ω–æ –ø–æ–π–º–∞—Ç—å —Å–∫–∏–¥–∫–∏ –Ω–∞ 30-40% –¥–µ—à–µ–≤–ª–µ.",
            "–û–±—ã—á–Ω–æ –±–∏–ª–µ—Ç—ã —Å—Ç–æ—è—Ç 12-18 —Ç—ã—Å—è—á, –Ω–æ –≤ –º–µ–∂—Å–µ–∑–æ–Ω –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏ –∑–∞ 6-8 —Ç—ã—Å—è—á. –°–ª–µ–¥–∏—Ç–µ –∑–∞ –∞–∫—Ü–∏—è–º–∏.",
            "–ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–µ–∑–æ–Ω–∞. –°–µ–π—á–∞—Å –ø—Ä–∏–º–µ—Ä–Ω–æ 15–∫-20–∫, –≤ –Ω–∏–∑–∫–∏–π —Å–µ–∑–æ–Ω –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –∑–∞ 8-10–∫."
        ],
        
        "service_recommendation": [
            "–Ø –ø—Ä–æ–±–æ–≤–∞–ª —Ä–∞–∑–Ω—ã–µ, –ª—É—á—à–µ –≤—Å–µ–≥–æ: Aviasales –¥–ª—è –±–∏–ª–µ—Ç–æ–≤, Booking –¥–ª—è –æ—Ç–µ–ª–µ–π, Wise –¥–ª—è –≤–∞–ª—é—Ç—ã.",
            "–°–æ–≤–µ—Ç—É—é —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –Ω–∞ 3-4 —Å–∞–π—Ç–∞—Ö. –ß–∞—Å—Ç–æ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –±–∏–ª–µ—Ç —Ä–∞–∑–ª–∏—á–∞–µ—Ç—Å—è –Ω–∞ 2-3 —Ç—ã—Å—è—á–∏ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏.",
            "Aviasales + Skyscanner –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Å–∞–º—É—é —à–∏—Ä–æ–∫—É—é –≤—ã–±–æ—Ä–∫—É. Google Flights —Ç–æ–∂–µ –Ω–µ–ø–ª–æ—Ö–æ–π."
        ],
        
        "destination": [
            "–ó–∞–≤–∏—Å–∏—Ç –æ—Ç –±—é–¥–∂–µ—Ç–∞ –∏ —Å–µ–∑–æ–Ω–∞. –°–µ–π—á–∞—Å –≤—ã–≥–æ–¥–Ω–æ: –¢—É—Ä—Ü–∏—è, –ì—Ä—É–∑–∏—è, –û–ê–≠ (–±–µ–∑–≤–∏–∑ –¥–ª—è —Ä–æ—Å—Å–∏—è–Ω).",
            "–†–µ–∫–æ–º–µ–Ω–¥—É—é –ì—Ä—É–∑–∏—é –∏–ª–∏ –¢—É—Ä—Ü–∏—é ‚Äî –±–ª–∏–∑–∫–æ, –Ω–µ–¥–æ—Ä–æ–≥–æ, –±–µ–∑–≤–∏–∑. –ù–∞ –Ω–µ–¥–µ–ª—é –º–æ–∂–Ω–æ —É–ª–æ–∂–∏—Ç—å—Å—è –≤ 30-40 —Ç—ã—Å—è—á.",
            "–î–ª—è –±—é–¥–∂–µ—Ç–Ω–æ–≥–æ –æ—Ç–¥—ã—Ö–∞: –ê–±—Ö–∞–∑–∏—è, –ì—Ä—É–∑–∏—è, –¢—É—Ä—Ü–∏—è. –î–ª—è —ç–∫–∑–æ—Ç–∏–∫–∏ –ø–æ–¥–µ—à–µ–≤–ª–µ: –¢–∞–∏–ª–∞–Ω–¥, –í—å–µ—Ç–Ω–∞–º —á–µ—Ä–µ–∑ –°—Ç–∞–º–±—É–ª."
        ],
        
        "savings": [
            "–û—Å–Ω–æ–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã: –ø–æ–∫—É–ø–∞—Ç—å –∑–∞—Ä–∞–Ω–µ–µ (–∑–∞ 2-3 –º–µ—Å—è—Ü–∞), —Å–º–æ—Ç—Ä–µ—Ç—å –≥–∏–±–∫–∏–µ –¥–∞—Ç—ã, –ª–µ—Ç–µ—Ç—å —Å –ø–µ—Ä–µ—Å–∞–¥–∫–∞–º–∏, —Å–ª–µ–¥–∏—Ç—å –∑–∞ –∞–∫—Ü–∏—è–º–∏.",
            "–õ–∞–π—Ñ—Ö–∞–∫–∏: —Å—Ä–µ–¥–∞-—á–µ—Ç–≤–µ—Ä–≥ –¥–µ—à–µ–≤–ª–µ, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –±–∞–≥–∞–∂–∞ –¥–æ—Ä–æ–∂–µ, –±—Ä–æ–Ω–∏—Ä—É–π—Ç–µ –∂–∏–ª—å—ë –Ω–∞–ø—Ä—è–º—É—é (–±–µ–∑ –ø–æ—Å—Ä–µ–¥–Ω–∏–∫–æ–≤).",
            "–Ø —ç–∫–æ–Ω–æ–º–ª—é —Ç–∞–∫: —Ä–∞–Ω–µ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä—ã, –ª–æ—É–∫–æ—Å—Ç–µ—Ä—ã —Å –ø–µ—Ä–µ—Å–∞–¥–∫–∞–º–∏, –º–µ—Å—Ç–Ω–∞—è –µ–¥–∞ –≤–º–µ—Å—Ç–æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤."
        ]
    ]
    
    init(logger: Logger) {
        self.logger = logger
    }
    
    func generateReply(category: String, context: ReplyContext) -> String {
        // –ë–µ—Ä—ë–º —Å–ª—É—á–∞–π–Ω—ã–π —à–∞–±–ª–æ–Ω –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        guard let categoryTemplates = templates[category] else {
            // Fallback –Ω–∞ –æ–±—â–∏–π —à–∞–±–ª–æ–Ω
            return templates["service_recommendation"]!.randomElement()!
        }
        
        let template = categoryTemplates.randomElement()!
        
        logger.info("üìù Generated template reply for category: \(category)")
        
        return template
    }
}
```

### 8. Services/ReplyGenerator/AIReplyService.swift (OpenAI GPT-4o Mini)

```swift
import Vapor

final class AIReplyService {
    private let client: Client
    private let apiKey: String
    private let logger: Logger
    
    init(client: Client, apiKey: String, logger: Logger) {
        self.client = client
        self.apiKey = apiKey
        self.logger = logger
    }
    
    func generateReply(
        question: String,
        category: String?,
        context: ReplyContext
    ) async throws -> String {
        let prompt = buildPrompt(question: question, category: category, context: context)
        
        let url = URI(string: "https://api.openai.com/v1/chat/completions")
        
        var request = ClientRequest(method: .POST, url: url)
        request.headers.add(name: "Authorization", value: "Bearer \(apiKey)")
        request.headers.add(name: .contentType, value: "application/json")
        
        let body: [String: Any] = [
            "model": "gpt-4o-mini",
            "messages": [
                [
                    "role": "system",
                    "content": systemPrompt
                ],
                [
                    "role": "user",
                    "content": prompt
                ]
            ],
            "max_tokens": 200,
            "temperature": 0.8
        ]
        
        request.body = .init(data: try JSONSerialization.data(withJSONObject: body))
        
        let response = try await client.send(request)
        
        guard response.status == .ok else {
            logger.error("‚ùå OpenAI API error: \(response.status)")
            throw Abort(.internalServerError)
        }
        
        struct OpenAIResponse: Codable {
            struct Choice: Codable {
                struct Message: Codable {
                    let content: String
                }
                let message: Message
            }
            let choices: [Choice]
        }
        
        let aiResponse = try response.content.decode(OpenAIResponse.self)
        let generatedText = aiResponse.choices.first?.message.content ?? ""
        
        logger.info("‚úÖ AI reply generated: \(generatedText.prefix(50))...")
        
        return generatedText
    }
    
    private let systemPrompt = """
    –¢—ã ‚Äî –ø–æ–ª–µ–∑–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö Telegram –∫–∞–Ω–∞–ª–∞ –æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è—Ö.
    
    –¢–≤–æ—è –∑–∞–¥–∞—á–∞: –¥–∞–≤–∞—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–µ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è), –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ, –ø–æ–ª–µ–∑–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã.
    
    –ü–†–ê–í–ò–õ–ê:
    1. –ü–∏—à–∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ, –∫–∞–∫ –æ–±—ã—á–Ω—ã–π —á–µ–ª–æ–≤–µ–∫
    2. –ò—Å–ø–æ–ª—å–∑—É–π –ª–∏—á–Ω—ã–π –æ–ø—ã—Ç: "–Ø –æ–±—ã—á–Ω–æ...", "–°–∞–º —Ç–∞–∫ –¥–µ–ª–∞—é..."
    3. –î–∞–≤–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–æ–≤–µ—Ç—ã, –Ω–µ –æ–±—â–∏–µ —Ñ—Ä–∞–∑—ã
    4. –ú–∞–∫—Å 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (50-80 —Å–ª–æ–≤)
    5. 1-2 —ç–º–æ–¥–∑–∏ –º–∞–∫—Å–∏–º—É–º
    6. –ù–ï —É–ø–æ–º–∏–Ω–∞–π –Ω–∏–∫–∞–∫–∏–µ –±–æ—Ç—ã/–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—ç—Ç–æ –¥–æ–±–∞–≤–∏—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ)
    
    –°–¢–ò–õ–¨:
    - –î—Ä—É–∂–µ–ª—é–±–Ω—ã–π, –ø–æ–ª–µ–∑–Ω—ã–π
    - –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π, —Å —Ü–∏—Ñ—Ä–∞–º–∏
    - –ë–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö —Å–ª–æ–≤
    - –ë–µ–∑ AI-—à—Ç–∞–º–ø–æ–≤ ("–≤–∞–∂–Ω–æ –æ—Ç–º–µ—Ç–∏—Ç—å", "—Å–ª–µ–¥—É–µ—Ç —É—á–µ—Å—Ç—å")
    
    –ü–†–ò–ú–ï–†–´:
    
    –í–æ–ø—Ä–æ—Å: "–ì–¥–µ –Ω–∞–π—Ç–∏ –¥–µ—à–µ–≤—ã–µ –±–∏–ª–µ—Ç—ã –≤ –¢—É—Ä—Ü–∏—é?"
    –û—Ç–≤–µ—Ç: "–Ø –æ–±—ã—á–Ω–æ –º–æ–Ω–∏—Ç–æ—Ä—é Aviasales –∏ –°–∫–∞–π—Å–∫–∞–Ω–µ—Ä. –õ—É—á—à–∏–µ —Ü–µ–Ω—ã –≤ —Å—Ä–µ–¥—É-—á–µ—Ç–≤–µ—Ä–≥, –∑–∞ 2-3 –º–µ—Å—è—Ü–∞ –¥–æ –≤—ã–ª–µ—Ç–∞. –¢—É—Ä—Ü–∏—è —Å–µ–π—á–∞—Å 12-18 —Ç—ã—Å—è—á —Ç—É–¥–∞-–æ–±—Ä–∞—Ç–Ω–æ üòä"
    
    –í–æ–ø—Ä–æ—Å: "–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –Ω–µ–¥–µ–ª—è –≤ –ì—Ä—É–∑–∏–∏?"
    –û—Ç–≤–µ—Ç: "–†–µ–∞–ª—å–Ω–æ —É–ª–æ–∂–∏—Ç—å—Å—è –≤ 30-35 —Ç—ã—Å—è—á: –±–∏–ª–µ—Ç—ã 8–∫, –∂–∏–ª—å—ë 400‚ÇΩ/–¥–µ–Ω—å, –µ–¥–∞ 500‚ÇΩ/–¥–µ–Ω—å. –í–∏–Ω–æ –∏ —Ö–∞—á–∞–ø—É—Ä–∏ –¥–µ—à—ë–≤—ã–µ. –ì—Ä—É–∑–∏—è ‚Äî —Ç–æ–ø –ø–æ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—é —Ü–µ–Ω–∞/–∫–∞—á–µ—Å—Ç–≤–æ!"
    
    –í–æ–ø—Ä–æ—Å: "–ö–∞–∫–æ–π —Å–µ—Ä–≤–∏—Å –ª—É—á—à–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ –æ—Ç–µ–ª–µ–π?"
    –û—Ç–≤–µ—Ç: "–Ø –ø–æ–ª—å–∑—É—é—Å—å –ë—É–∫–∏–Ω–≥–æ–º, –Ω–æ –≤—Å–µ–≥–¥–∞ —Å–≤–µ—Ä—è—é —Å –û—Å—Ç—Ä–æ–≤–∫–æ–º –∏ –•–æ—Ç–µ–ª–ª—É–∫. –ò–Ω–æ–≥–¥–∞ —Ä–∞–∑–Ω–∏—Ü–∞ –¥–æ 20%. –ï—â—ë –ª–∞–π—Ñ—Ö–∞–∫: –∏—Å–∫–∞—Ç—å –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ —Å–∞–π—Ç–µ –æ—Ç–µ–ª—è, –±—ã–≤–∞–µ—Ç –¥–µ—à–µ–≤–ª–µ."
    """
    
    private func buildPrompt(question: String, category: String?, context: ReplyContext) -> String {
        """
        –í–û–ü–†–û–° –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø:
        "\(question)"
        
        –ö–û–ù–¢–ï–ö–°–¢:
        - –ö–∞—Ç–µ–≥–æ—Ä–∏—è: \(category ?? "–æ–±—â–∏–π –≤–æ–ø—Ä–æ—Å")
        - –ö–∞–Ω–∞–ª: \(context.channelName)
        
        –û—Ç–≤–µ—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å –≤—ã—à–µ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –∏ –ø–æ–ª–µ–∑–Ω–æ):
        """
    }
}
```

### 9. Services/ReplyPoster/AntiSpamService.swift

```swift
import Vapor
import Fluent

final class AntiSpamService {
    private let db: Database
    private let logger: Logger
    
    init(db: Database, logger: Logger) {
        self.db = db
        self.logger = logger
    }
    
    // –ö–û–ù–°–ï–†–í–ê–¢–ò–í–ù–´–ï –ª–∏–º–∏—Ç—ã (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫)
    func canPost(to comment: Comment) async throws -> Bool {
        let now = Date()
        
        // 1. –£–∂–µ –æ—Ç–≤–µ—á–∞–ª–∏?
        if comment.replied {
            return false
        }
        
        // 2. –õ–∏–º–∏—Ç –≤ —á–∞—Å (–º–∞–∫—Å 2)
        let oneHourAgo = now.addingTimeInterval(-3600)
        let repliesLastHour = try await Reply.query(on: db)
            .filter(\.$postedAt > oneHourAgo)
            .filter(\.$posted == true)
            .count()
        
        if repliesLastHour >= 2 {
            logger.warning("‚è∞ Hourly limit: \(repliesLastHour)/2")
            return false
        }
        
        // 3. –õ–∏–º–∏—Ç –≤ –¥–µ–Ω—å (–º–∞–∫—Å 20)
        let oneDayAgo = now.addingTimeInterval(-86400)
        let repliesToday = try await Reply.query(on: db)
            .filter(\.$postedAt > oneDayAgo)
            .filter(\.$posted == true)
            .count()
        
        if repliesToday >= 20 {
            logger.warning("üìÖ Daily limit: \(repliesToday)/20")
            return false
        }
        
        // 4. –ú–∏–Ω–∏–º—É–º 10 –º–∏–Ω—É—Ç —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ—Ç–≤–µ—Ç–∞
        if let lastReply = try await Reply.query(on: db)
            .filter(\.$posted == true)
            .sort(\.$postedAt, .descending)
            .first(),
           let lastPostedAt = lastReply.postedAt {
            
            let timeSince = now.timeIntervalSince(lastPostedAt)
            if timeSince < 600 {
                logger.warning("‚è± Too soon: \(Int(timeSince))s < 600s")
                return false
            }
        }
        
        // 5. –õ–∏–º–∏—Ç –Ω–∞ –∫–∞–Ω–∞–ª (–º–∞–∫—Å 3 –æ—Ç–≤–µ—Ç–∞/–¥–µ–Ω—å)
        let post = try await comment.$post.get(on: db)
        let channel = try await post.$channel.get(on: db)
        
        let repliesInChannel = try await Reply.query(on: db)
            .join(Comment.self, on: \Reply.$comment.$id == \Comment.$id)
            .join(Post.self, on: \Comment.$post.$id == \Post.$id)
            .filter(Post.self, \.$channel.$id == channel.requireID())
            .filter(\.$postedAt > oneDayAgo)
            .filter(\.$posted == true)
            .count()
        
        if repliesInChannel >= 3 {
            logger.warning("üì∫ Channel limit: \(repliesInChannel)/3 in @\(channel.username)")
            return false
        }
        
        // 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –∫–∞–Ω–∞–ª–∞ (—Ç–æ–ª—å–∫–æ < 10k)
        if channel.subscribersCount > 10_000 {
            logger.warning("üë• Channel too large: \(channel.subscribersCount)")
            return false
        }
        
        // 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ cooldown –ø–æ—Å–ª–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞
        if try await isInCooldown() {
            logger.warning("‚ùÑÔ∏è In cooldown mode")
            return false
        }
        
        return true
    }
    
    private func isInCooldown() async throws -> Bool {
        let now = Date()
        
        let activeIncident = try await Incident.query(on: db)
            .filter(\.$cooldownUntil > now)
            .first()
        
        return activeIncident != nil
    }
}
```

### 10. Jobs/CommentAnalysisJob.swift

```swift
import Vapor
import Queues

struct CommentAnalysisJob: AsyncScheduledJob {
    let questionDetector: QuestionDetectorService
    let replyGenerator: HybridReplyService
    let db: Database
    
    // –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
    func run(context: QueueContext) async throws {
        context.logger.info("üîç [CommentAnalysisJob] Starting...")
        
        // 1. –ù–∞–π—Ç–∏ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
        let comments = try await Comment.query(on: db)
            .filter(\.$replied == false)
            .filter(\.$relevanceScore == 0.0) // –ï—â—ë –Ω–µ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏
            .limit(50)
            .all()
        
        context.logger.info("üìä Found \(comments.count) new comments to analyze")
        
        for comment in comments {
            // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞: —ç—Ç–æ –≤–æ–ø—Ä–æ—Å?
            let isQuestion = questionDetector.isQuestion(comment.text)
            comment.isQuestion = isQuestion
            
            if !isQuestion {
                try await comment.save(on: db)
                continue
            }
            
            // 3. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å
            let relevance = questionDetector.calculateRelevance(comment.text)
            comment.relevanceScore = relevance
            
            // 4. –ù–∞–π—Ç–∏ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
            comment.keywordsMatched = questionDetector.matchKeywords(comment.text)
            
            // 5. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
            comment.category = questionDetector.detectCategory(comment.text)
            
            try await comment.save(on: db)
            
            // 6. –ï—Å–ª–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å –≤—ã—Å–æ–∫–∞—è (>= 0.7), –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
            if relevance >= 0.7 {
                let post = try await comment.$post.get(on: db)
                let channel = try await post.$channel.get(on: db)
                
                let replyContext = ReplyContext(
                    channelName: channel.title,
                    postTopic: post.text.prefix(100).description,
                    botUsername: Environment.get("BOT_USERNAME") ?? "gdeTravel_bot"
                )
                
                do {
                    let replyText = try await replyGenerator.generateReply(
                        question: comment.text,
                        category: comment.category,
                        relevance: relevance,
                        context: replyContext
                    )
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
                    let reply = Reply()
                    reply.$comment.id = try comment.requireID()
                    reply.generatedText = replyText
                    reply.posted = false
                    
                    try await reply.save(on: db)
                    
                    context.logger.info("‚úÖ Reply generated for comment \(comment.id?.uuidString ?? "")")
                    
                } catch {
                    context.logger.error("‚ùå Failed to generate reply: \(error)")
                }
            }
        }
        
        context.logger.info("‚úÖ [CommentAnalysisJob] Completed")
    }
}
```

### 11. Jobs/ReplyPostingJob.swift

```swift
import Vapor
import Queues

struct ReplyPostingJob: AsyncScheduledJob {
    let telegramClient: TelegramClient
    let antiSpam: AntiSpamService
    let db: Database
    
    // –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 20 –º–∏–Ω—É—Ç
    func run(context: QueueContext) async throws {
        context.logger.info("üì§ [ReplyPostingJob] Starting...")
        
        // 1. –ù–∞–π—Ç–∏ –≥–æ—Ç–æ–≤—ã–µ, –Ω–æ –Ω–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
        let pendingReplies = try await Reply.query(on: db)
            .filter(\.$posted == false)
            .sort(\.$createdAt, .ascending) // –°—Ç–∞—Ä—ã–µ –ø–µ—Ä–≤—ã–º–∏
            .limit(5) // –ú–∞–∫—Å 5 –∑–∞ —Ä–∞–∑
            .all()
        
        context.logger.info("üìä Found \(pendingReplies.count) pending replies")
        
        for reply in pendingReplies {
            let comment = try await reply.$comment.get(on: db)
            
            // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤
            guard try await antiSpam.canPost(to: comment) else {
                context.logger.info("‚è≠ Skipping reply (anti-spam limits)")
                continue
            }
            
            // 3. –°–ª—É—á–∞–π–Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º 40% –≤–æ–ø—Ä–æ—Å–æ–≤ (–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å)
            if Double.random(in: 0...1) < 0.4 {
                context.logger.info("üé≤ Randomly skipping (looks more natural)")
                
                // –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ "–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π, –Ω–æ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–π"
                comment.replied = true
                try await comment.save(on: db)
                
                // –£–¥–∞–ª—è–µ–º –æ—Ç–≤–µ—Ç
                try await reply.delete(on: db)
                continue
            }
            
            // 4. –°–ª—É—á–∞–π–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ (10-20 –º–∏–Ω—É—Ç)
            let delay = TimeInterval.random(in: 600...1200)
            context.logger.info("‚è≥ Waiting \(Int(delay/60)) minutes before posting...")
            try await Task.sleep(nanoseconds: UInt64(delay * 1_000_000_000))
            
            // 5. –ü—É–±–ª–∏–∫–∞—Ü–∏—è
            do {
                let post = try await comment.$post.get(on: db)
                let channel = try await post.$channel.get(on: db)
                
                let messageId = try await telegramClient.sendReply(
                    chatUsername: channel.username,
                    replyToMessageId: comment.telegramMessageId,
                    text: reply.generatedText
                )
                
                // 6. –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
                reply.posted = true
                reply.telegramReplyId = messageId
                reply.postedAt = Date()
                try await reply.save(on: db)
                
                comment.replied = true
                try await comment.save(on: db)
                
                context.logger.info("‚úÖ Reply posted successfully!")
                
                // 7. –î–æ–±–∞–≤–ª—è–µ–º –µ—â—ë –æ–¥–Ω—É –∑–∞–¥–µ—Ä–∂–∫—É –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–∏–º (5-10 –º–∏–Ω)
                let extraDelay = TimeInterval.random(in: 300...600)
                try await Task.sleep(nanoseconds: UInt64(extraDelay * 1_000_000_000))
                
            } catch let error as BotError {
                context.logger.error("üö® Bot error: \(error)")
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –æ—à–∏–±–æ–∫
                if case .floodControl = error {
                    // Flood control ‚Üí –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—Å—è –Ω–∞ 1 —á–∞—Å
                    try await createIncident(
                        reason: "Flood control detected",
                        cooldownHours: 1
                    )
                    break // –ü—Ä–µ—Ä—ã–≤–∞–µ–º —Ü–∏–∫–ª
                }
                
                if case .botBlocked = error {
                    // –ë–æ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω ‚Üí –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—Å—è –Ω–∞ 48 —á–∞—Å–æ–≤
                    try await createIncident(
                        reason: "Bot blocked",
                        cooldownHours: 48
                    )
                    break
                }
                
            } catch {
                context.logger.error("‚ùå Unexpected error: \(error)")
            }
        }
        
        context.logger.info("‚úÖ [ReplyPostingJob] Completed")
    }
    
    private func createIncident(reason: String, cooldownHours: Int) async throws {
        let incident = Incident()
        incident.reason = reason
        incident.timestamp = Date()
        incident.cooldownUntil = Date().addingTimeInterval(TimeInterval(cooldownHours * 3600))
        
        try await incident.save(on: db)
    }
}
```

### 12. Application/configure.swift

```swift
import Vapor
import Fluent
import FluentPostgresDriver
import Queues

public func configure(_ app: Application) async throws {
    // MARK: - Database
    guard let databaseURL = Environment.get("DATABASE_URL") else {
        fatalError("DATABASE_URL not set")
    }
    
    try app.databases.use(.postgres(url: databaseURL), as: .psql)
    
    // MARK: - Migrations
    app.migrations.add(CreateChannels())
    app.migrations.add(CreatePosts())
    app.migrations.add(CreateComments())
    app.migrations.add(CreateReplies())
    app.migrations.add(CreateIncidents())
    
    try await app.autoMigrate()
    
    // MARK: - Services
    let botToken = Environment.get("TELEGRAM_BOT_TOKEN")!
    let aiProvider = Environment.get("AI_PROVIDER") ?? "openai"
    let botUsername = Environment.get("BOT_USERNAME") ?? "gdeTravel_bot"
    
    let telegramClient = TelegramClient(
        client: app.client,
        botToken: botToken,
        logger: app.logger
    )
    
    let questionDetector = QuestionDetectorService(logger: app.logger)
    
    // AI —Å–µ—Ä–≤–∏—Å (OpenAI GPT-4o Mini –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏)
    let aiReplyService: AIReplyService
    
    if aiProvider == "openai" {
        let openaiKey = Environment.get("OPENAI_API_KEY")!
        aiReplyService = AIReplyService(
            client: app.client,
            apiKey: openaiKey,
            logger: app.logger
        )
    } else {
        // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É Claude
        fatalError("Only OpenAI supported for now")
    }
    
    let templateService = TemplateReplyService(logger: app.logger)
    
    let hybridReply = HybridReplyService(
        templateService: templateService,
        aiService: aiReplyService,
        logger: app.logger
    )
    
    let antiSpam = AntiSpamService(db: app.db, logger: app.logger)
    
    // MARK: - Queues
    try app.queues.use(.memory)
    
    // –ê–Ω–∞–ª–∏–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
    app.queues.schedule(
        CommentAnalysisJob(
            questionDetector: questionDetector,
            replyGenerator: hybridReply,
            db: app.db
        )
    )
    .minutely()
    .at(0, 10, 20, 30, 40, 50)
    
    // –ü—É–±–ª–∏–∫–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –∫–∞–∂–¥—ã–µ 20 –º–∏–Ω—É—Ç
    app.queues.schedule(
        ReplyPostingJob(
            telegramClient: telegramClient,
            antiSpam: antiSpam,
            db: app.db
        )
    )
    .minutely()
    .at(5, 25, 45)
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∫–∞–∂–¥—ã–π —á–∞—Å
    app.queues.schedule(SafetyCheckJob(db: app.db))
        .hourly()
        .at(0)
    
    try app.queues.startScheduledJobs()
    
    // MARK: - Routes
    try routes(app)
    
    app.logger.info("‚úÖ Application configured successfully")
}
```

### 13. Application/routes.swift

```swift
import Vapor

func routes(_ app: Application) throws {
    // Health check
    app.get("health") { req in
        ["status": "ok", "timestamp": Date().ISO8601Format()]
    }
    
    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    app.get("stats") { req async throws -> StatsResponse in
        let db = req.db
        
        // –ö–∞–Ω–∞–ª—ã
        let totalChannels = try await Channel.query(on: db).count()
        let activeChannels = try await Channel.query(on: db)
            .filter(\.$isActive == true)
            .count()
        
        // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
        let totalComments = try await Comment.query(on: db).count()
        let questions = try await Comment.query(on: db)
            .filter(\.$isQuestion == true)
            .count()
        
        // –û—Ç–≤–µ—Ç—ã
        let totalReplies = try await Reply.query(on: db).count()
        let postedReplies = try await Reply.query(on: db)
            .filter(\.$posted == true)
            .count()
        
        let today = Date().addingTimeInterval(-86400)
        let repliesToday = try await Reply.query(on: db)
            .filter(\.$postedAt > today)
            .filter(\.$posted == true)
            .count()
        
        // –ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã
        let incidents = try await Incident.query(on: db).count()
        let activeIncidents = try await Incident.query(on: db)
            .filter(\.$cooldownUntil > Date())
            .count()
        
        return StatsResponse(
            channels: .init(total: totalChannels, active: activeChannels),
            comments: .init(total: totalComments, questions: questions),
            replies: .init(total: totalReplies, posted: postedReplies, today: repliesToday),
            safety: .init(incidents: incidents, inCooldown: activeIncidents > 0)
        )
    }
    
    // –î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–∞–ª –≤—Ä—É—á–Ω—É—é
    app.post("channels") { req async throws -> Channel in
        struct AddChannelRequest: Content {
            let username: String
            let category: ChannelCategory
            let isWhitelisted: Bool?
        }
        
        let input = try req.content.decode(AddChannelRequest.self)
        
        let telegramClient = TelegramClient(
            client: req.client,
            botToken: Environment.get("TELEGRAM_BOT_TOKEN")!,
            logger: req.logger
        )
        
        // –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ –∏–∑ Telegram
        let chatInfo = try await telegramClient.getChat(username: input.username)
        
        let channel = Channel(
            username: input.username,
            title: chatInfo.title ?? input.username,
            category: input.category,
            subscribersCount: chatInfo.membersCount ?? 0,
            isWhitelisted: input.isWhitelisted ?? false
        )
        
        try await channel.save(on: req.db)
        
        return channel
    }
    
    // Emergency stop
    app.post("emergency-stop") { req async throws -> HTTPStatus in
        let incident = Incident()
        incident.reason = "Manual emergency stop"
        incident.timestamp = Date()
        incident.cooldownUntil = Date().addingTimeInterval(86400) // 24 —á–∞—Å–∞
        
        try await incident.save(on: req.db)
        
        req.logger.warning("üö® EMERGENCY STOP activated")
        
        return .ok
    }
}

struct StatsResponse: Content {
    struct ChannelStats: Content {
        let total: Int
        let active: Int
    }
    
    struct CommentStats: Content {
        let total: Int
        let questions: Int
    }
    
    struct ReplyStats: Content {
        let total: Int
        let posted: Int
        let today: Int
    }
    
    struct SafetyStats: Content {
        let incidents: Int
        let inCooldown: Bool
    }
    
    let channels: ChannelStats
    let comments: CommentStats
    let replies: ReplyStats
    let safety: SafetyStats
}
```

---

## üöÄ –î–µ–ø–ª–æ–π –∏ –∑–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# 1. –ö–ª–æ–Ω–∏—Ä—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞
mkdir telegram-auto-reply-bot
cd telegram-auto-reply-bot

# 2. –°–æ–∑–¥–∞—ë–º Package.swift (—Å–º. –≤—ã—à–µ)

# 3. –ö–æ–ø–∏—Ä—É–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã –∏–∑ –ø—Ä–∏–º–µ—Ä–æ–≤ –≤—ã—à–µ

# 4. –°–æ–∑–¥–∞—ë–º .env —Ñ–∞–π–ª
cp .env.example .env
# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º .env (—Å–º. "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤")

# 5. –ó–∞–ø—É—Å–∫–∞–µ–º —á–µ—Ä–µ–∑ Docker Compose
docker-compose up -d

# 6. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏
docker-compose logs -f app

# 7. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–¥–æ—Ä–æ–≤—å–µ
curl http://localhost:8080/health

# 8. –°–º–æ—Ç—Ä–∏–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
curl http://localhost:8080/stats
```

### –î–µ–ø–ª–æ–π –Ω–∞ Railway

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Railway CLI
brew install railway

# 2. –õ–æ–≥–∏–Ω
railway login

# 3. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
railway init

# 4. –î–æ–±–∞–≤–∏—Ç—å PostgreSQL
railway add

# –í—ã–±—Ä–∞—Ç—å: PostgreSQL

# 5. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
railway variables set TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω
railway variables set OPENAI_API_KEY=–≤–∞—à_–∫–ª—é—á
railway variables set BOT_USERNAME=gdeTravel_bot

# 6. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å
git add .
git commit -m "Initial commit"
railway up

# 7. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
railway logs

# 8. –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
railway open
```

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫

```bash
# 1. –î–æ–±–∞–≤–∏—Ç—å —Ü–µ–ª–µ–≤—ã–µ –∫–∞–Ω–∞–ª—ã
curl -X POST http://localhost:8080/channels \
  -H "Content-Type: application/json" \
  -d '{
    "username": "budget_travel_ru",
    "category": "travel",
    "isWhitelisted": true
  }'

# 2. –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—á–Ω—ë—Ç:
#    - –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∫–∞–Ω–∞–ª—ã –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
#    - –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
#    - –ü—É–±–ª–∏–∫–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã –∫–∞–∂–¥—ã–µ 20 –º–∏–Ω—É—Ç

# 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
watch -n 60 "curl -s http://localhost:8080/stats | jq"
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### Dashboard (–ø—Ä–æ—Å—Ç–æ–π)

```bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
#!/bin/bash

while true; do
    clear
    echo "=== TELEGRAM AUTO-REPLY BOT STATS ==="
    echo ""
    curl -s http://localhost:8080/stats | jq '
    {
        "–ö–∞–Ω–∞–ª—ã": .channels.active,
        "–í–æ–ø—Ä–æ—Å–æ–≤ –Ω–∞–π–¥–µ–Ω–æ": .comments.questions,
        "–û—Ç–≤–µ—Ç–æ–≤ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ —Å–µ–≥–æ–¥–Ω—è": .replies.today,
        "–í—Å–µ–≥–æ –æ—Ç–≤–µ—Ç–æ–≤": .replies.posted,
        "–°—Ç–∞—Ç—É—Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏": (if .safety.inCooldown then "üö® COOLDOWN" else "‚úÖ SAFE" end)
    }
    '
    echo ""
    echo "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥..."
    sleep 60
done
```

### –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

**–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ:**
1. **Engagement rate** - –†–µ–∞–∫—Ü–∏–∏ –Ω–∞ –≤–∞—à–∏ –æ—Ç–≤–µ—Ç—ã
   ```sql
   -- –°–∫–æ–ª—å–∫–æ –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ–ª—É—á–∏–ª–∏ –ª–∞–π–∫–∏/—Ä–µ–∞–∫—Ü–∏–∏?
   -- (–Ω—É–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å —á–µ—Ä–µ–∑ Telegram API)
   ```

2. **Conversion rate** - –ü–µ—Ä–µ—Ö–æ–¥—ã –≤ –±–æ—Ç–∞
   ```
   –£–Ω–∏–∫–∞–ª—å–Ω—ã–π UTM –≤ –∫–∞–∂–¥–æ–º –æ—Ç–≤–µ—Ç–µ:
   @gdeTravel_bot?start=from_comment_12345
   
   –¢—Ä–µ–∫–∏–Ω–≥ –≤ –æ—Å–Ω–æ–≤–Ω–æ–º –±–æ—Ç–µ
   ```

3. **Ban rate** - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏/–∂–∞–ª–æ–±—ã
   ```
   –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏ 403, 429
   ```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ 1 –º–µ—Å—è—Ü

**–ï—Å–ª–∏ —Ä–∏—Å–∫–∞ –Ω–µ—Ç (0 –±–∞–Ω–æ–≤, —Ö–æ—Ä–æ—à–∏–π engagement):**
```swift
// –ú–æ–∂–Ω–æ –Ω–µ–º–Ω–æ–≥–æ —É–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç—ã
maxRepliesPerDay: 20 ‚Üí 25
maxRepliesPerHour: 2 ‚Üí 3
minDelay: 600s ‚Üí 480s (8 –º–∏–Ω—É—Ç)
```

**–ï—Å–ª–∏ –µ—Å—Ç—å –∂–∞–ª–æ–±—ã/–ø–æ–¥–æ–∑—Ä–µ–Ω–∏—è:**
```swift
// –°–Ω–∏–∑–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
maxRepliesPerDay: 20 ‚Üí 15
maxRepliesPerHour: 2 ‚Üí 1
minDelay: 600s ‚Üí 900s (15 –º–∏–Ω—É—Ç)
skipProbability: 0.4 ‚Üí 0.6 (–ø—Ä–æ–ø—É—Å–∫–∞–µ–º 60%)
```

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π)

### –ü–µ—Ä–≤—ã–π –º–µ—Å—è—Ü

```
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
‚îú‚îÄ –û—Ç–≤–µ—Ç–æ–≤ –≤ –¥–µ–Ω—å: 20
‚îú‚îÄ –†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö: 70% = 14
‚îú‚îÄ –° —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º –±–æ—Ç–∞: 80% = 11
‚îú‚îÄ –ö–æ–Ω–≤–µ—Ä—Å–∏—è –≤ –±–æ—Ç–∞: 10% = 1-2 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è/–¥–µ–Ω—å
‚îî‚îÄ –ò—Ç–æ–≥–æ: 30-60 –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–°—Ç–æ–∏–º–æ—Å—Ç—å (–≥–∏–±—Ä–∏–¥):
‚îú‚îÄ 80% —à–∞–±–ª–æ–Ω—ã: 0‚ÇΩ
‚îú‚îÄ 20% GPT-4o Mini: ~10‚ÇΩ/–º–µ—Å—è—Ü
‚îî‚îÄ CAC: 0.2‚ÇΩ –∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–†–∏—Å–∫–∏:
‚îú‚îÄ –ë–∞–Ω –±–æ—Ç–∞: <1%
‚îú‚îÄ –ñ–∞–ª–æ–±—ã: <5%
‚îî‚îÄ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∞–¥–º–∏–Ω–∞–º–∏: <10%
```

### –ß–µ—Ä–µ–∑ 3 –º–µ—Å—è—Ü–∞ (–ø—Ä–∏ —É—Å–ø–µ—Ö–µ)

```
–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:
‚îú‚îÄ –ö–∞–Ω–∞–ª–æ–≤: 5 ‚Üí 15
‚îú‚îÄ –û—Ç–≤–µ—Ç–æ–≤: 20/–¥–µ–Ω—å ‚Üí 30/–¥–µ–Ω—å
‚îú‚îÄ –ù–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 100-150/–º–µ—Å—è—Ü
‚îú‚îÄ –°—Ç–æ–∏–º–æ—Å—Ç—å: ~30‚ÇΩ/–º–µ—Å—è—Ü
‚îî‚îÄ CAC: 0.25‚ÇΩ

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ (Telegram Ads):
‚îú‚îÄ –ë—é–¥–∂–µ—Ç: 50,000‚ÇΩ/–º–µ—Å—è—Ü
‚îú‚îÄ –ù–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 500/–º–µ—Å—è—Ü
‚îî‚îÄ CAC: 100‚ÇΩ

–≠–∫–æ–Ω–æ–º–∏—è: 199,920‚ÇΩ –∑–∞ 3 –º–µ—Å—è—Ü–∞! üöÄ
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –∑–∞–ø—É—Å–∫–∞

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (1-2 –¥–Ω—è)

- [ ] –°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather
- [ ] –ü–æ–ª—É—á–∏—Ç—å OpenAI API –∫–ª—é—á
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å PostgreSQL (Railway/Supabase)
- [ ] –ó–∞–ø–æ–ª–Ω–∏—Ç—å .env —Ñ–∞–π–ª
- [ ] –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –±–æ—Ç—ã (2-3 —à—Ç)

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (3-5 –¥–Ω–µ–π)

- [ ] –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å–µ –º–æ–¥–µ–ª–∏
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Jobs
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã
- [ ] –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ (1 –¥–µ–Ω—å)

- [ ] –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ Railway
- [ ] –î–æ–±–∞–≤–∏—Ç—å 3-5 whitelist –∫–∞–Ω–∞–ª–æ–≤
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–≤—ã–µ 5-10 –æ—Ç–≤–µ—Ç–æ–≤ –≤—Ä—É—á–Ω—É—é
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–ø–µ—Ä–≤–∞—è –Ω–µ–¥–µ–ª—è)

- [ ] –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ª–æ–≥–∏ 2 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å
- [ ] –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å engagement rate
- [ ] –§–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∂–∞–ª–æ–±—ã/–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- [ ] –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–∏–º–∏—Ç—ã –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

---

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

### ‚úÖ –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è (–†–ï–ö–û–ú–ï–ù–î–£–Æ):

```yaml
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
  –æ—Ç–≤–µ—Ç–æ–≤_–≤_–¥–µ–Ω—å: 20
  –∑–∞–¥–µ—Ä–∂–∫–∞_–º–∏–Ω–∏–º—É–º: 10 –º–∏–Ω—É—Ç
  –∑–∞–¥–µ—Ä–∂–∫–∞_—Å–ª—É—á–∞–π–Ω–∞—è: 10-20 –º–∏–Ω—É—Ç
  ai_provider: GPT-4o Mini
  —Å—Ç—Ä–∞—Ç–µ–≥–∏—è: 80% —à–∞–±–ª–æ–Ω—ã + 20% AI
  –∫–∞–Ω–∞–ª—ã: —Ç–æ–ª—å–∫–æ whitelist < 10k –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
  
–≠–∫–æ–Ω–æ–º–∏–∫–∞:
  —Å—Ç–æ–∏–º–æ—Å—Ç—å: ~10‚ÇΩ/–º–µ—Å—è—Ü
  –Ω–æ–≤—ã—Ö_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 30-60/–º–µ—Å—è—Ü
  CAC: 0.2‚ÇΩ
  
–†–∏—Å–∫–∏:
  –±–∞–Ω_–±–æ—Ç–∞: <1%
  –∂–∞–ª–æ–±—ã: <5%
  —É—Å–ø–µ—Ö: >90%
```

**–ù–∞—á–Ω–∏ —Å —ç—Ç–æ–≥–æ, –∞ —á–µ—Ä–µ–∑ –º–µ—Å—è—Ü –º–æ–∂–µ—à—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –µ—Å–ª–∏ –≤—Å—ë –û–ö!** üöÄ

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
1. –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏: `railway logs` –∏–ª–∏ `docker-compose logs`
2. –ü—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É: `curl http://localhost:8080/stats`
3. Emergency stop: `curl -X POST http://localhost:8080/emergency-stop`

**–£—Å–ø–µ—Ö–æ–≤ –≤ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏!** üéâ

